<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Certificate - TESTIFY</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font for body and headings -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Font for main certificate title -->
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700&display=swap" rel="stylesheet">
    <!-- Elegant script font for the student's name -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* A softer background color */
        }
        .certificate-title {
            font-family: 'Merriweather', serif;
        }
        .student-name {
            font-family: 'Dancing Script', cursive;
        }
        /* Styles for printing */
        @media print {
            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                background-color: #ffffff;
            }
            .no-print {
                display: none !important;
            }
            .printable-area {
                box-shadow: none !important;
                margin: 0;
                padding: 0;
                border-radius: 0;
                border: 10px solid #1e3a8a; /* Ensure border prints */
            }
            .page-break {
                page-break-after: always;
            }
        }
        /* A subtle background pattern for the certificate */
        .guilloche-bg {
            background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCI+PGcgZmlsbC1ydWxlPSJldmVub2RkIj48ZyBmaWxsPSIjM2I4MmY2IiBmaWxsLW9wYWNpdHk9IjAuMDUiPjxwYXRoIG9wYWNpdHk9Ii4zIiBkPSJNMCAxMDBhNTAgNTAtMCAwIDAgMTAwIDBMMTAwIDUwQTUwIDUwLTAgMCAxIDUwIDB2NTB6Ii8+PHBhdGggZD0iTTAgMEE1MCA1MC0wIDAgMSA1MCA1MFYwSDB6Ii8+PC9nPjwvZz48L3N2Zz4=');
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="max-w-5xl mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Action buttons, hidden when printing -->
        <div class="flex justify-between items-center mb-6 no-print">
            <a href="#" class="text-indigo-600 hover:text-indigo-800 transition-colors duration-300">&larr; Back to My Certificates</a>
            <button onclick="window.print()" class="px-6 py-3 bg-indigo-700 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-300 transform hover:scale-105">
                Print or Save as PDF
            </button>
        </div>

        <!-- Certificate container -->
        <div class="printable-area bg-white rounded-xl shadow-2xl relative overflow-hidden border-t-4 border-amber-400">
            <!-- Background pattern -->
            <div class="absolute inset-0 guilloche-bg"></div>
            
            <!-- Ornate border created with nested divs -->
            <div class="absolute inset-0 p-2">
                <div class="w-full h-full border-8 border-indigo-900 rounded-lg"></div>
            </div>
            <div class="absolute inset-0 p-4">
                <div class="w-full h-full border-2 border-amber-300 rounded-md"></div>
            </div>

            <div class="relative z-10 p-8 sm:p-12 lg:p-16 text-center">
                <!-- Header section with logo -->
                <div class="flex justify-center items-center mb-8">
                    <img class="h-24 w-24" src="https://res.cloudinary.com/dpz44zf0z/image/upload/v1756037774/Gemini_Generated_Image_eu0ib0eu0ib0eu0i_z0amjh.png" alt="TESTIFY Logo">
                </div>

                <!-- Certificate main text -->
                <p class="text-xl text-gray-600 uppercase tracking-widest">Certificate of Achievement</p>
                <h1 class="certificate-title text-5xl sm:text-6xl font-bold text-indigo-900 mt-2">Completion</h1>
                
                <p class="mt-12 text-lg text-gray-700">This certificate is proudly presented to</p>
                
                <h2 id="student-name" class="student-name text-5xl sm:text-6xl font-semibold text-gray-900 my-4 px-4 border-b-2 border-gray-300 inline-block">
                    Loading...
                </h2>
                
                <p class="text-lg text-gray-700">for successfully completing the test</p>
                
                <h3 id="test-title" class="text-3xl sm:text-4xl font-bold text-indigo-800 my-4">
                    Loading...
                </h3>

                <!-- Footer section with seal and signatures -->
                <div class="mt-16 flex flex-col sm:flex-row justify-between items-center text-gray-600 w-full max-w-3xl mx-auto">
                    <!-- Signature of Instructor -->
                    <div class="w-full sm:w-1/3 text-center mb-8 sm:mb-0">
                        <div class="border-b-2 border-gray-400 pb-1 px-8 h-16 flex justify-center items-end">
                             <img src="https://res.cloudinary.com/dpz44zf0z/image/upload/v1756125669/signature_3_p6pq1i.png" alt="Signature" class="h-12 mx-auto">
                        </div>
                        <p class="text-sm mt-2 font-semibold">LEAD INSTRUCTOR</p>
                    </div>

                    <!-- Official Seal -->
                    <div class="w-full sm:w-1/3 flex justify-center order-first sm:order-none mb-8 sm:mb-0">
                        <div class="w-36 h-36 rounded-full bg-indigo-900 flex items-center justify-center text-white font-bold text-center p-2 shadow-lg border-4 border-white">
                            <div class="w-full h-full rounded-full border-4 border-amber-400 flex items-center justify-center flex-col leading-tight">
                                <span class="text-amber-400 text-2xl">&#9733;</span>
                                <span>TESTIFY</span>
                                <span class="text-xs font-normal mt-1">OFFICIAL SEAL</span>
                                <span class="text-amber-400 text-2xl">&#9733;</span>
                            </div>
                        </div>
                    </div>

                    <!-- Date of Issue -->
                    <div class="w-full sm:w-1/3 text-center">
                        <p id="issue-date" class="border-b-2 border-gray-400 pb-1 px-8 h-16 flex justify-center items-end">Loading...</p>
                        <p class="text-sm mt-2 font-semibold">DATE OF ISSUE</p>
                    </div>
                </div>

                <!-- Certificate ID -->
                <p class="text-xs text-gray-400 mt-12">Certificate ID: <span id="cert-id">Loading...</span></p>
            </div>
        </div>
    </div>
    
    <!-- Footer outside the certificate -->
    <footer class="text-center text-sm text-gray-500 py-4 no-print">
        &copy; 2025 TESTIFY. All Rights Reserved.
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // This function takes the certificate data and populates the HTML elements.
            const populateCertificate = (data) => {
                document.getElementById('student-name').textContent = data.studentName;
                document.getElementById('test-title').textContent = data.testTitle;
                // Formats the date for better readability, e.g., "August 25, 2025"
                document.getElementById('issue-date').textContent = new Date(data.issuedAt).toLocaleDateString('en-US', {
                    year: 'numeric', month: 'long', day: 'numeric'
                });
                document.getElementById('cert-id').textContent = data.certificateId;
            };

            // --- Dynamic Data Fetching Logic ---

            // 1. Get the authentication token from local storage.
            const token = localStorage.getItem('token');
            if (!token) {
                // If there's no token, the user is not logged in.
                // Redirect them to the login page.
                // Note: Using a custom message for now to avoid breaking the preview.
                document.body.innerHTML = '<div class="text-center p-8"><h1>Access Denied</h1><p>You must be logged in to view a certificate. Redirecting...</p></div>';
                // setTimeout(() => window.location.href = '/login.html', 3000);
                return;
            }

            // 2. Get the certificate ID from the page's URL (e.g., ?id=CERT-12345).
            const urlParams = new URLSearchParams(window.location.search);
            const certificateId = urlParams.get('id');
            if (!certificateId) {
                // If the URL doesn't have an ID, we can't fetch the certificate.
                // Note: Using a custom message for now.
                document.body.innerHTML = '<div class="text-center p-8"><h1>Error</h1><p>No certificate ID was specified in the URL.</p></div>';
                return;
            }

            // 3. Fetch the certificate data from the API.
            try {
                // Construct the API endpoint with the specific certificate ID.
                // IMPORTANT: Replace '/api/student/certificate/' with your actual API endpoint.
                const response = await fetch(`/api/student/certificate/${certificateId}`, {
                    headers: {
                        // Include the authentication token in the request headers.
                        'x-auth-token': token
                    }
                });

                // Check if the server responded with an error (e.g., 404 Not Found, 401 Unauthorized).
                if (!response.ok) {
                    throw new Error(`Failed to fetch certificate data. Server responded with status: ${response.status}`);
                }
                
                // If the request was successful, parse the JSON data from the response.
                const data = await response.json();
                
                // Call the function to populate the certificate with the fetched data.
                populateCertificate(data);

            } catch (error) {
                // If anything goes wrong during the fetch process, log the error.
                console.error('Error loading certificate:', error);
                // Display an error message to the user.
                document.body.innerHTML = `<div class="text-center p-8"><h1>Error</h1><p>Could not load the certificate data. Please check the console for details.</p><p class="text-red-500 mt-2">${error.message}</p></div>`;
            }
        });
    </script>
</body>
</html>
