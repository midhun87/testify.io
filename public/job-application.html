<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apply for Job - HIRE WITH US</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="https://res.cloudinary.com/dpz44zf0z/image/upload/v1760086493/HireWithUS_wtn0pc.png">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .form-step { display: none; animation: fadeIn 0.5s ease-in-out; }
        .form-step.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .file-input-wrapper { position: relative; overflow: hidden; display: inline-block; cursor: pointer; }
        .file-input-button { border: 2px dashed #d1d5db; transition: background-color 0.2s, border-color 0.2s; }
        .file-input-wrapper:hover .file-input-button { background-color: #f0f5ff; border-color: #4f46e5; }
        .file-input { position: absolute; left: 0; top: 0; opacity: 0; width: 100%; height: 100%; cursor: pointer; }
    </style>
</head>
<body class="bg-slate-50">

    <header class="bg-white border-b border-slate-200">
        <div class="container mx-auto px-4 lg:px-6 py-4 flex justify-center items-center">
             <img src="https://res.cloudinary.com/dpz44zf0z/image/upload/v1760086493/HireWithUS_wtn0pc.png" alt="Hire With Us Logo" class="h-16 w-auto">
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 lg:py-12">
        <div class="max-w-6xl mx-auto">
            <div id="page-loader" class="text-center p-12">
                <svg class="animate-spin h-8 w-8 text-indigo-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                <p class="mt-4 text-slate-600">Loading Application...</p>
            </div>
            
            <div id="application-content" class="hidden">
                 <div class="text-left mb-8">
                    <h1 id="page-title" class="text-3xl md:text-4xl font-bold text-slate-900">Job Application</h1>
                    <p id="job-title-header" class="mt-2 text-lg text-indigo-600 font-semibold">Loading...</p>
                </div>

                <div class="lg:grid lg:grid-cols-12 lg:gap-12">
                    <aside class="lg:col-span-3 mb-8 lg:mb-0">
                        <div id="progress-bar" class="space-y-6"></div>
                    </aside>

                    <div class="lg:col-span-9">
                        <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                            <form id="application-form" class="space-y-8" novalidate>
                                <div id="form-feedback" class="text-sm"></div>
                                <div id="navigation-buttons" class="pt-6 border-t border-slate-200 flex justify-between items-center">
                                    <button type="button" id="prev-btn" class="text-slate-700 bg-slate-200 hover:bg-slate-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-colors">Previous</button>
                                    <button type="button" id="next-btn" class="text-white bg-indigo-600 hover:bg-indigo-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-colors">Next Step</button>
                                    <button type="submit" id="submit-button" class="hidden w-full md:w-auto text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-lg px-8 py-3 text-center transition-colors">Submit Application</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
    document.addEventListener('DOMContentLoaded', async () => {
        const pageLoader = document.getElementById('page-loader');
        const applicationContent = document.getElementById('application-content');
        const applicationForm = document.getElementById('application-form');
        const jobTitleHeader = document.getElementById('job-title-header');
        const pageTitle = document.getElementById('page-title');
        const formFeedback = document.getElementById('form-feedback');
        
        const progressBar = document.getElementById('progress-bar');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitButton = document.getElementById('submit-button');

        const urlParams = new URLSearchParams(window.location.search);
        const jobId = urlParams.get('jobId');
        
        let currentStep = 0;
        const steps = [
            { name: "Personal Details", icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>` },
            { name: "Education", icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M12 14l9-5-9-5-9 5 9 5z" /><path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-5.998 12.078 12.078 0 01.665-6.479L12 14z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5zm0 0v6" /></svg>`},
            { name: "Experience", icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>` },
            { name: "Links & Documents", icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" /></svg>` }
        ];

        let eduCounter = 0;
        let expCounter = 0;

        function renderFormHTML() {
            const inputClasses = "bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5 transition";
            applicationForm.insertAdjacentHTML('afterbegin', `
                <!-- Step 1: Personal Details -->
                <div class="form-step active" data-step="0">
                    <h2 class="text-2xl font-semibold mb-6 text-slate-800">Personal Details</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div><label for="firstName" class="block mb-2 text-sm font-medium text-slate-700">First Name</label><input type="text" name="firstName" class="${inputClasses}" required></div>
                        <div><label for="lastName" class="block mb-2 text-sm font-medium text-slate-700">Last Name</label><input type="text" name="lastName" class="${inputClasses}" required></div>
                        <div><label for="email" class="block mb-2 text-sm font-medium text-slate-700">Email Address</label><input type="email" name="email" class="${inputClasses}" required></div>
                        <div><label for="phone" class="block mb-2 text-sm font-medium text-slate-700">Mobile Number</label><input type="tel" name="phone" class="${inputClasses}" required></div>
                    </div>
                </div>
                <!-- Step 2: Education -->
                <div class="form-step" data-step="1">
                     <h2 class="text-2xl font-semibold mb-6 text-slate-800">Educational Details</h2>
                     <div id="education-container" class="space-y-6"></div>
                     <button type="button" id="add-education" class="mt-4 text-sm font-medium text-indigo-600 hover:text-indigo-800 transition-colors">+ Add Education</button>
                </div>
                <!-- Step 3: Experience -->
                <div class="form-step" data-step="2">
                    <h2 class="text-2xl font-semibold mb-6">Professional Experience</h2>
                    <div id="experience-container" class="space-y-6"></div>
                    <button type="button" id="add-experience" class="mt-4 text-sm font-medium text-indigo-600 hover:text-indigo-800 transition-colors">+ Add Experience (Optional)</button>
                </div>
                <!-- Step 4: Links & Documents -->
                <div class="form-step" data-step="3">
                    <h2 class="text-2xl font-semibold mb-6">Links & Documents</h2>
                    <div class="space-y-8">
                         <div><h3 class="font-medium text-slate-800 mb-3">Professional Links (Optional)</h3><div class="grid grid-cols-1 md:grid-cols-3 gap-6"><div><label for="linkedinUrl" class="block mb-2 text-sm font-medium text-slate-700">LinkedIn URL</label><input type="url" name="linkedinUrl" id="linkedinUrl" class="${inputClasses}"></div><div><label for="githubUrl" class="block mb-2 text-sm font-medium text-slate-700">GitHub URL</label><input type="url" name="githubUrl" id="githubUrl" class="${inputClasses}"></div><div><label for="portfolioUrl" class="block mb-2 text-sm font-medium text-slate-700">Portfolio URL</label><input type="url" name="portfolioUrl" id="portfolioUrl" class="${inputClasses}"></div></div></div>
                         <div><h3 class="font-medium text-slate-800 mb-4">Upload Documents</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                             <div><label for="passportPhoto" class="block mb-2 text-sm font-medium text-slate-700">Passport Photo</label><div class="file-input-wrapper w-full"><div id="passportPhoto-ui" class="file-input-button rounded-lg p-4 text-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-slate-400 mb-2 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg><span class="font-medium text-indigo-600">Click to upload</span><span id="passportPhoto-info" class="text-xs text-slate-500 mt-1 block">JPG, PNG (Max 2MB)</span></div><input type="file" name="passportPhoto" id="passportPhoto" class="file-input" accept="image/jpeg, image/png" required></div></div>
                             <div><label for="resume" class="block mb-2 text-sm font-medium text-slate-700">Resume/CV</label><div class="file-input-wrapper w-full"><div id="resume-ui" class="file-input-button rounded-lg p-4 text-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-slate-400 mb-2 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg><span class="font-medium text-indigo-600">Click to upload</span><span id="resume-info" class="text-xs text-slate-500 mt-1 block">PDF, DOCX (Max 5MB)</span></div><input type="file" name="resume" id="resume" class="file-input" accept=".pdf,.doc,.docx" required></div></div>
                             <div class="md:col-span-2">
                                 <label for="govtIdType" class="block mb-2 text-sm font-medium text-slate-700">Government Issued ID (Optional)</label>
                                 <select name="govtIdType" id="govtIdType" class="${inputClasses} mb-4">
                                     <option value="">-- Select ID Type --</option>
                                     <option value="Aadhar">Aadhar Card</option>
                                     <option value="PAN">PAN Card</option>
                                     <option value="Voter">Voter ID</option>
                                     <option value="Driving License">Driving License</option>
                                     <option value="Passport">Passport</option>
                                 </select>
                                 <div class="file-input-wrapper w-full">
                                     <div id="govtId-ui" class="file-input-button rounded-lg p-4 text-center">
                                         <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-slate-400 mb-2 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 012-2h2a2 2 0 012 2v1m-6 0h6" /></svg>
                                         <span class="font-medium text-indigo-600">Upload ID Picture</span>
                                         <span id="govtId-info" class="text-xs text-slate-500 mt-1 block">JPG, PNG, PDF (Max 2MB)</span>
                                     </div>
                                     <input type="file" name="govtId" id="govtId" class="file-input" accept="image/jpeg,image/png,.pdf">
                                 </div>
                             </div>
                         </div></div>
                    </div>
                </div>
            `);
            
            ['passportPhoto', 'resume', 'govtId'].forEach(id => {
                const input = document.getElementById(id);
                const infoEl = document.getElementById(`${id}-info`);
                input.addEventListener('change', () => {
                    if(input.files.length > 0) {
                         infoEl.textContent = input.files[0].name;
                         infoEl.classList.add('text-green-600', 'font-semibold');
                    } else {
                        infoEl.textContent = infoEl.dataset.defaultText;
                        infoEl.classList.remove('text-green-600', 'font-semibold');
                    }
                });
                 infoEl.dataset.defaultText = infoEl.textContent;
            });
        }

        function updateProgressBar() {
            progressBar.innerHTML = '';
            steps.forEach((step, index) => {
                let state = 'default';
                if (index < currentStep) state = 'completed';
                else if (index === currentStep) state = 'active';

                let content = (state === 'completed') ? `
                    <div class="flex items-center p-4 bg-green-50 rounded-lg">
                        <div class="flex-shrink-0 w-8 h-8 rounded-full bg-green-500 text-white flex items-center justify-center"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div>
                        <div class="ml-4"><p class="font-semibold text-green-700">${step.name}</p></div>
                    </div>` : (state === 'active') ? `
                    <div class="flex items-center p-4 bg-indigo-50 border-l-4 border-indigo-500 rounded-lg">
                        <div class="flex-shrink-0 w-8 h-8 rounded-full bg-indigo-500 text-white flex items-center justify-center">${step.icon}</div>
                        <div class="ml-4"><p class="font-semibold text-indigo-700">${step.name}</p></div>
                    </div>` : `
                    <div class="flex items-center p-4 bg-slate-100 rounded-lg">
                        <div class="flex-shrink-0 w-8 h-8 rounded-full bg-slate-300 text-slate-600 flex items-center justify-center">${step.icon}</div>
                        <div class="ml-4"><p class="font-medium text-slate-500">${step.name}</p></div>
                    </div>`;
                progressBar.innerHTML += content;
            });
        }

        function showStep(stepIndex) {
            document.querySelectorAll('.form-step').forEach(step => step.classList.remove('active'));
            document.querySelector(`.form-step[data-step="${stepIndex}"]`)?.classList.add('active');
            
            currentStep = stepIndex;
            updateProgressBar();

            prevBtn.style.display = currentStep === 0 ? 'none' : 'inline-block';
            nextBtn.style.display = currentStep === steps.length - 1 ? 'none' : 'inline-block';
            submitButton.style.display = currentStep === steps.length - 1 ? 'inline-block' : 'none';
            
            document.getElementById('navigation-buttons').classList.toggle('justify-end', currentStep === 0);
            document.getElementById('navigation-buttons').classList.toggle('justify-between', currentStep > 0);
        }
        
        function validateStep(stepIndex) {
            const currentStepElement = document.querySelector(`.form-step[data-step="${stepIndex}"]`);
            const inputs = currentStepElement.querySelectorAll('input[required], select[required], textarea[required]');
            let isValid = true;
            inputs.forEach(input => {
                input.classList.remove('border-red-500');
                if ((input.type === 'file' && input.files.length === 0) || (input.type !== 'file' && !input.value.trim())) {
                    input.classList.add('border-red-500');
                    isValid = false;
                }
            });
            if (!isValid) {
                 formFeedback.innerHTML = `<div class="p-3 text-red-800 bg-red-100 rounded-lg flex items-center"><svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>Please fill all required fields in this step.</div>`;
            } else {
                formFeedback.innerHTML = '';
            }
            return isValid;
        }

        nextBtn.addEventListener('click', () => {
            if (validateStep(currentStep) && currentStep < steps.length - 1) showStep(currentStep + 1);
        });

        prevBtn.addEventListener('click', () => {
            if (currentStep > 0) {
                formFeedback.innerHTML = '';
                showStep(currentStep - 1);
            }
        });

        function addEducationField() {
            const container = document.getElementById('education-container');
            const div = document.createElement('div');
            const eduId = eduCounter++;
            div.className = 'p-4 border border-slate-200 rounded-lg bg-slate-50 relative';
            const inputClasses = "bg-white border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5 transition";
            div.innerHTML = `
                <button type="button" class="absolute top-3 right-3 text-slate-400 hover:text-red-600 hover:bg-red-100 rounded-full p-1" onclick="this.parentElement.remove()">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                </button>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" name="edu_type" placeholder="Type of Study (e.g., Bachelor's)" class="${inputClasses}" required>
                    <input type="text" name="edu_institute" placeholder="Institution Name" class="${inputClasses}" required>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                    <input type="text" name="edu_stream" placeholder="Stream (e.g., Computer Science)" class="${inputClasses}" required>
                    <input type="text" name="edu_score" placeholder="Marks/CGPA/Percentage" class="${inputClasses}" required>
                </div>
                <div class="mt-4">
                    <label for="edu_cert_${eduId}" class="block mb-2 text-sm font-medium text-slate-700">Certificate (Optional)</label>
                    <div class="file-input-wrapper w-full"><div class="file-input-button rounded-lg p-3 text-center flex items-center justify-center text-sm"><svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><span id="edu-cert-info-${eduId}" class="ml-2 text-slate-500 truncate">Upload PDF, JPG, PNG</span></div><input type="file" name="education_certificate_${eduId}" id="edu_cert_${eduId}" class="file-input" accept=".pdf,.jpg,.png"></div>
                </div>`;
            container.appendChild(div);
            attachFileInputListener(div, `edu_cert_${eduId}`, `edu-cert-info-${eduId}`);
        }
        
        function addExperienceField() {
            const container = document.getElementById('experience-container');
            const div = document.createElement('div');
            const expId = expCounter++;
            div.className = 'p-4 border border-slate-200 rounded-lg bg-slate-50 relative';
            const inputClasses = "bg-white border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5 transition";
            div.innerHTML = `
                <button type="button" class="absolute top-3 right-3 text-slate-400 hover:text-red-600 hover:bg-red-100 rounded-full p-1" onclick="this.parentElement.remove()">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                </button>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" name="exp_title" placeholder="Job Title" class="${inputClasses}">
                    <input type="text" name="exp_company" placeholder="Company" class="${inputClasses}">
                </div>
                <textarea name="exp_desc" placeholder="Responsibilities..." rows="3" class="mt-3 block p-2.5 w-full text-sm ${inputClasses}"></textarea>
                 <div class="mt-4">
                    <label for="exp_cert_${expId}" class="block mb-2 text-sm font-medium text-slate-700">Experience Certificate (Optional)</label>
                    <div class="file-input-wrapper w-full"><div class="file-input-button rounded-lg p-3 text-center flex items-center justify-center text-sm"><svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><span id="exp-cert-info-${expId}" class="ml-2 text-slate-500 truncate">Upload PDF, JPG, PNG</span></div><input type="file" name="experience_certificate_${expId}" id="exp_cert_${expId}" class="file-input" accept=".pdf,.jpg,.png"></div>
                </div>`;
            container.appendChild(div);
            attachFileInputListener(div, `exp_cert_${expId}`, `exp-cert-info-${expId}`);
        }

        function attachFileInputListener(parent, inputId, infoId) {
            const fileInput = parent.querySelector(`#${inputId}`);
            const infoEl = parent.querySelector(`#${infoId}`);
            infoEl.dataset.defaultText = infoEl.textContent;
            fileInput.addEventListener('change', () => {
                if (fileInput.files.length > 0) {
                    infoEl.textContent = fileInput.files[0].name;
                    infoEl.classList.add('text-green-600', 'font-semibold');
                } else {
                    infoEl.textContent = infoEl.dataset.defaultText;
                    infoEl.classList.remove('text-green-600', 'font-semibold');
                }
            });
        }
        
        async function initialize() {
            if (!jobId) {
                pageLoader.innerHTML = '<p class="text-red-600 font-semibold">Error: Job ID is missing from the URL.</p>';
                return;
            }

            try {
                const response = await fetch(`/api/public/jobs/${jobId}`);
                if (!response.ok) throw new Error((await response.json()).message || 'Job not found or has expired.');
                const job = await response.json();
                
                document.title = `Apply for ${job.title} - HIRE WITH US`;
                jobTitleHeader.textContent = `For the role of ${job.title}`;
            } catch(error) {
                 pageLoader.innerHTML = `<p class="text-red-600 font-semibold">${error.message}</p>`;
                 return;
            }

            renderFormHTML();
            document.getElementById('add-education').addEventListener('click', () => addEducationField());
            document.getElementById('add-experience').addEventListener('click', () => addExperienceField());
            
            addEducationField();

            showStep(0);
            pageLoader.classList.add('hidden');
            applicationContent.classList.remove('hidden');
            applicationForm.addEventListener('submit', handleFormSubmit);
        }
        
        async function handleFormSubmit(e) {
            e.preventDefault();
            if (!validateStep(currentStep)) return;

            submitButton.disabled = true;
            submitButton.innerHTML = `<svg class="animate-spin h-5 w-5 mr-3 inline" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg> Submitting...`;
            formFeedback.innerHTML = '';

            const formData = new FormData(applicationForm);

            const education = [];
            document.querySelectorAll('#education-container > div').forEach(div => {
                const type = div.querySelector('[name="edu_type"]').value;
                const institute = div.querySelector('[name="edu_institute"]').value;
                const stream = div.querySelector('[name="edu_stream"]').value;
                const score = div.querySelector('[name="edu_score"]').value;
                if(type && institute) education.push({ type, institute, stream, score });
            });
            formData.append('education', JSON.stringify(education));

            const experiences = [];
            document.querySelectorAll('#experience-container > div').forEach(div => {
                const title = div.querySelector('[name="exp_title"]').value;
                const company = div.querySelector('[name="exp_company"]').value;
                const description = div.querySelector('[name="exp_desc"]').value;
                if(title && company) experiences.push({ title, company, description });
            });
            formData.append('experiences', JSON.stringify(experiences));
            
            formData.delete('edu_type');
            formData.delete('edu_institute');
            formData.delete('edu_stream');
            formData.delete('edu_score');
            formData.delete('exp_title');
            formData.delete('exp_company');
            formData.delete('exp_desc');

            try {
                const response = await fetch(`/api/careers/apply/${jobId}`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (!response.ok) throw new Error(result.message || 'An unknown error occurred.');
                
                formFeedback.innerHTML = `<div class="p-4 text-green-800 bg-green-100 rounded-lg">${result.message}</div>`;
                applicationForm.reset();
                
                setTimeout(() => {
                    applicationContent.innerHTML = `<div class="text-center bg-white p-12 rounded-2xl shadow-lg"><svg class="w-24 h-24 mx-auto text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><h2 class="text-3xl font-bold text-slate-800 mt-6">Thank You!</h2><p class="mt-2 text-slate-600">${result.message}</p><a href="careers.html" class="mt-8 inline-block text-white bg-indigo-600 hover:bg-indigo-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Back to All Jobs</a></div>`;
                }, 2000);

            } catch (error) {
                formFeedback.innerHTML = `<div class="p-4 text-red-800 bg-red-100 rounded-lg">Error: ${error.message}</div>`;
            } finally {
                submitButton.disabled = false;
                submitButton.innerHTML = 'Submit Application';
            }
        }
        
        initialize();
    });
    </script>
</body>
</html>


